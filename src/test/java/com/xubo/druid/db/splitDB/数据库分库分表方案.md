# 分库分表
## 参考
https://mp.weixin.qq.com/s/pU5_ltc9zYE5yKd_K_VYmA
## 分库
按照业务逻辑划分，将数据库拆分成多个不同业务需求的数据库。这个其实是有问题的，只能保证改业务不影响其他业务的正常运行。

## 分表 

### 垂直拆分
#### 优化表的字段，拆成多张表
##### 问题
单表数据过长，这样会导致跨页的问题。MySQL一页容纳不下，存到另一页，赵成额外寻址，导致性能开销增加。

##### 优势
1、业务划分明确，类似微服务的思想职责清晰
2、针对不同数据，可以实现冷热分离，动静分离

##### 缺点
1、业务拆分到多个库后，可能出现跨库join的问题，只能在代码层面聚合
2、分布式事务问题
3、垂直拆分仍然无法解决单表数据量过大的问题


### 水平拆分
#### 描述
水平拆分需要针对具体的分片键，设置一定的路由规则，拆分到多张表上。

#### 优点
1、避免单表数据量过大，查询成为性能瓶颈
2、水平分表的结构一致，横向扩展时，业务端可以做到无感知改动

#### 难点
1、路由规则复杂，难以抽象
2、多次拆分难度大，数据扩容难度大
3、水平拆分也会出现跨库join问题

### 水平拆分实践
#### 问题
##### 主键id生成的问题
使用全局Id

##### 非分片键查询问题
id%2=1 id%2=0  使用这样的规章进行路由操作
大多数场景，我们使用主键作为分片键，这样路由规则只和主键相关。我们通过主键查询，很容易就路由到对应的查询想要的数据。

但是有的业务，可能需要查询uid下的所有数据，而相同的uid可能被分配到多张表中。这样我们就得在代码层面聚合多张表的数据，非常麻烦，效率也低。

